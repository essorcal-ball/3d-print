<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>StegoPrints â€“ Custom 3D Printing</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<script type="module"
  src="https://unpkg.com/@google/model-viewer/dist/model-viewer.min.js">
</script>

<style>
body {
  margin: 0;
  font-family: Arial, sans-serif;
  background: #0f172a;
  color: #e5e7eb;
  text-align: center;
}

.hidden { display: none; }

.card {
  background: #020617;
  padding: 20px;
  margin: 30px auto;
  width: 340px;
  border-radius: 12px;
}

input, select, textarea, button {
  width: 100%;
  padding: 10px;
  margin: 8px 0;
  border-radius: 8px;
  border: none;
}

button {
  background: #38bdf8;
  font-weight: bold;
  cursor: pointer;
}

.grid {
  display: grid;
  grid-template-columns: repeat(auto-fit, 220px);
  gap: 20px;
  justify-content: center;
  padding: 20px;
}

model-viewer {
  width: 100%;
  height: 160px;
  background: #020617;
}

table {
  width: 90%;
  margin: auto;
  border-collapse: collapse;
}

td, th {
  border-bottom: 1px solid #334155;
  padding: 8px;
}
</style>
</head>

<body>

<!-- LOGIN PAGE -->
<div id="loginPage" class="card">
  <h1>StegoPrints</h1>
  <input id="email" placeholder="Email">
  <input id="password" type="password" placeholder="Password">
  <button onclick="login()">Login</button>
  <button onclick="signup()">Sign Up</button>
</div>

<!-- MODELS PAGE -->
<div id="modelsPage" class="hidden">
  <h1>Choose a Model</h1>
  <div class="grid" id="modelGrid"></div>
  <button onclick="adminPrompt()">Admin</button>
</div>

<!-- CUSTOMIZE PAGE -->
<div id="customizePage" class="hidden">
  <h1 id="modelTitle"></h1>

  <div class="card">
    <label>Color</label>
    <input id="color" placeholder="Red / Blue / Rainbow">

    <label>Size</label>
    <select id="size">
      <option>Small</option>
      <option>Medium</option>
      <option>Large</option>
    </select>

    <label>Quantity</label>
    <input id="qty" type="number" min="1" value="1">

    <label>Premium Upgrades</label>
    <select id="premium">
      <option>None</option>
      <option>Two Colors</option>
      <option>High Detail</option>
      <option>Flexible Material</option>
    </select>

    <label>Special Requests</label>
    <textarea id="notes"></textarea>

    <button onclick="placeOrder()">Submit Order</button>
  </div>
</div>

<!-- ADMIN PAGE -->
<div id="adminPage" class="hidden">
  <h1>Admin Orders</h1>
  <table id="ordersTable"></table>
</div>

<script>
/* ---------- AUTH ---------- */
function signup() {
  let users = JSON.parse(localStorage.getItem("users")) || {};
  let e = email.value;
  let p = password.value;
  if (users[e]) return alert("User already exists");
  users[e] = btoa(p);
  localStorage.setItem("users", JSON.stringify(users));
  alert("Account created");
}

function login() {
  let users = JSON.parse(localStorage.getItem("users")) || {};
  let e = email.value;
  let p = password.value;
  if (users[e] === btoa(p)) {
    localStorage.setItem("user", e);
    show("modelsPage");
    loadModels();
  } else alert("Login failed");
}

/* ---------- MODELS ---------- */
const models = [
  {name:"Articulated Dragon", file:"dragon.stl"},
  {name:"Flexi Dino", file:"dino.stl"},
  {name:"Infinity Cube", file:"cube.stl"},
  {name:"Fidget Snake", file:"snake.stl"},
  {name:"Mini Robot", file:"robot.stl"},
  {name:"Gear Sphere", file:"gear.stl"},
  {name:"Flexi Shark", file:"shark.stl"}
];

function loadModels() {
  let grid = document.getElementById("modelGrid");
  grid.innerHTML = "";
  models.forEach(m => {
    let div = document.createElement("div");
    div.className = "card";
    div.innerHTML = `
      <h3>${m.name}</h3>
      <model-viewer src="${m.file}" auto-rotate camera-controls></model-viewer>
      <button onclick="selectModel('${m.name}')">Customize</button>
    `;
    grid.appendChild(div);
  });
}

function selectModel(name) {
  localStorage.setItem("model", name);
  document.getElementById("modelTitle").innerText = name;
  show("customizePage");
}

/* ---------- ORDERS ---------- */
function placeOrder() {
  let orders = JSON.parse(localStorage.getItem("orders")) || [];
  orders.push({
    user: localStorage.getItem("user"),
    model: localStorage.getItem("model"),
    color: color.value,
    size: size.value,
    qty: qty.value,
    premium: premium.value,
    notes: notes.value,
    time: new Date().toLocaleString()
  });
  localStorage.setItem("orders", JSON.stringify(orders));
  alert("Order submitted");
  show("modelsPage");
}

/* ---------- ADMIN ---------- */
function adminPrompt() {
  let pass = prompt("Admin Password");
  if (pass !== "stego") return alert("Access denied");
  show("adminPage");
  loadOrders();
}

function loadOrders() {
  let table = document.getElementById("ordersTable");
  let orders = JSON.parse(localStorage.getItem("orders")) || [];
  table.innerHTML = "<tr><th>User</th><th>Model</th><th>Qty</th><th>Premium</th><th>Time</th></tr>";
  orders.forEach(o => {
    table.innerHTML += `
      <tr>
        <td>${o.user}</td>
        <td>${o.model}</td>
        <td>${o.qty}</td>
        <td>${o.premium}</td>
        <td>${o.time}</td>
      </tr>`;
  });
}

/* ---------- PAGE SWITCH ---------- */
function show(id) {
  ["loginPage","modelsPage","customizePage","adminPage"]
    .forEach(p => document.getElementById(p).classList.add("hidden"));
  document.getElementById(id).classList.remove("hidden");
}
</script>

</body>
</html>
