<!DOCTYPE html>
<html>
<head>
  <title>Ison 3D</title>
  <link rel="stylesheet" href="style.css">
</head>
<body class="fade">

<header>
  <h1>Ison 3D</h1>
  <nav>
    <button onclick="show('home')">Home</button>
    <button onclick="show('login')">Login</button>
    <button onclick="show('register')">Create Account</button>
    <button onclick="show('notifications')" id="notifBtn" hidden>Notifications</button>
  </nav>
</header>

<section id="home">
  <h2>Order 3D Prints</h2>
  <button onclick="order()">Place Order</button>
</section>

<section id="login" class="hidden">
  <h2>Login</h2>
  <input id="luser" placeholder="Username">
  <input id="lpass" type="password" placeholder="Password">
  <button onclick="login()">Login</button>
</section>

<section id="register" class="hidden">
  <h2>Create Account</h2>
  <p><b>Use your real name so we know who to deliver to.</b></p>
  <input id="rname" placeholder="Real Name" required>
  <input id="ruser" placeholder="Username">
  <input id="rpass" type="password" placeholder="Password">
  <button onclick="register()">Create</button>
</section>

<section id="notifications" class="hidden">
  <h2>Your Notifications</h2>
  <pre id="notes"></pre>
</section>

<script>
let user = null;

function show(id) {
  document.querySelectorAll("section").forEach(s => s.classList.add("hidden"));
  document.getElementById(id).classList.remove("hidden");
}

function register() {
  fetch("/register", {
    method: "POST",
    headers: { "Content-Type": "application/json" },
    body: JSON.stringify({
      realName: rname.value,
      username: ruser.value,
      password: rpass.value
    })
  }).then(() => alert("Account created"));
}

function login() {
  fetch("/login", {
    method: "POST",
    headers: { "Content-Type": "application/json" },
    body: JSON.stringify({
      username: luser.value,
      password: lpass.value
    })
  })
  .then(r => r.json())
  .then(d => {
    if (d.error) return alert(d.error);
    user = d;
    notifBtn.hidden = false;
    alert("Logged in as " + user.realName);
    show("home");
  });
}

function order() {
  if (!user) return alert("Login first");
  fetch("/order", {
    method: "POST",
    headers: { "Content-Type": "application/json" },
    body: JSON.stringify({
      user: user.username,
      premium: user.premium
    })
  }).then(() => alert("Order placed. Pay in cash."));
}

function loadNotes() {
  fetch("/notifications/" + user.username)
    .then(r => r.json())
    .then(d => notes.textContent = JSON.stringify(d, null, 2));
}

notifBtn.onclick = () => {
  show("notifications");
  loadNotes();
};
</script>

</body>
</html>
